{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Stage = exports.stages = void 0;\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Container_1 = require(\"./Container\");\nvar Global_1 = require(\"./Global\");\nvar Canvas_1 = require(\"./Canvas\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Global_2 = require(\"./Global\");\nvar PointerEvents = require(\"./PointerEvents\");\nvar STAGE = 'Stage',\n  STRING = 'string',\n  PX = 'px',\n  MOUSEOUT = 'mouseout',\n  MOUSELEAVE = 'mouseleave',\n  MOUSEOVER = 'mouseover',\n  MOUSEENTER = 'mouseenter',\n  MOUSEMOVE = 'mousemove',\n  MOUSEDOWN = 'mousedown',\n  MOUSEUP = 'mouseup',\n  POINTERMOVE = 'pointermove',\n  POINTERDOWN = 'pointerdown',\n  POINTERUP = 'pointerup',\n  POINTERCANCEL = 'pointercancel',\n  LOSTPOINTERCAPTURE = 'lostpointercapture',\n  CONTEXTMENU = 'contextmenu',\n  CLICK = 'click',\n  DBL_CLICK = 'dblclick',\n  TOUCHSTART = 'touchstart',\n  TOUCHEND = 'touchend',\n  TAP = 'tap',\n  DBL_TAP = 'dbltap',\n  TOUCHMOVE = 'touchmove',\n  WHEEL = 'wheel',\n  CONTENT_MOUSEOUT = 'contentMouseout',\n  CONTENT_MOUSEOVER = 'contentMouseover',\n  CONTENT_MOUSEMOVE = 'contentMousemove',\n  CONTENT_MOUSEDOWN = 'contentMousedown',\n  CONTENT_MOUSEUP = 'contentMouseup',\n  CONTENT_CONTEXTMENU = 'contentContextmenu',\n  CONTENT_CLICK = 'contentClick',\n  CONTENT_DBL_CLICK = 'contentDblclick',\n  CONTENT_TOUCHSTART = 'contentTouchstart',\n  CONTENT_TOUCHEND = 'contentTouchend',\n  CONTENT_DBL_TAP = 'contentDbltap',\n  CONTENT_TAP = 'contentTap',\n  CONTENT_TOUCHMOVE = 'contentTouchmove',\n  CONTENT_POINTERMOVE = 'contentPointermove',\n  CONTENT_POINTERDOWN = 'contentPointerdown',\n  CONTENT_POINTERUP = 'contentPointerup',\n  CONTENT_WHEEL = 'contentWheel',\n  RELATIVE = 'relative',\n  KONVA_CONTENT = 'konvajs-content',\n  SPACE = ' ',\n  UNDERSCORE = '_',\n  CONTAINER = 'container',\n  MAX_LAYERS_NUMBER = 5,\n  EMPTY_STRING = '',\n  EVENTS = [MOUSEENTER, MOUSEDOWN, MOUSEMOVE, MOUSEUP, MOUSELEAVE, TOUCHSTART, TOUCHMOVE, TOUCHEND, MOUSEOVER, WHEEL, CONTEXTMENU, POINTERDOWN, POINTERMOVE, POINTERUP, POINTERCANCEL, LOSTPOINTERCAPTURE],\n  eventsLength = EVENTS.length;\nfunction addEvent(ctx, eventName) {\n  ctx.content.addEventListener(eventName, function (evt) {\n    ctx[UNDERSCORE + eventName](evt);\n  }, false);\n}\nvar NO_POINTERS_MESSAGE = \"Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);\";\nexports.stages = [];\nfunction checkNoClip(attrs) {\n  if (attrs === void 0) {\n    attrs = {};\n  }\n  if (attrs.clipFunc || attrs.clipWidth || attrs.clipHeight) {\n    Util_1.Util.warn('Stage does not support clipping. Please use clip for Layers or Groups.');\n  }\n  return attrs;\n}\nvar Stage = function (_super) {\n  __extends(Stage, _super);\n  function Stage(config) {\n    var _this = _super.call(this, checkNoClip(config)) || this;\n    _this._pointerPositions = [];\n    _this._changedPointerPositions = [];\n    _this._buildDOM();\n    _this._bindContentEvents();\n    exports.stages.push(_this);\n    _this.on('widthChange.konva heightChange.konva', _this._resizeDOM);\n    _this.on('visibleChange.konva', _this._checkVisibility);\n    _this.on('clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva', function () {\n      checkNoClip(_this.attrs);\n    });\n    _this._checkVisibility();\n    return _this;\n  }\n  Stage.prototype._validateAdd = function (child) {\n    var isLayer = child.getType() === 'Layer';\n    var isFastLayer = child.getType() === 'FastLayer';\n    var valid = isLayer || isFastLayer;\n    if (!valid) {\n      Util_1.Util.throw('You may only add layers to the stage.');\n    }\n  };\n  Stage.prototype._checkVisibility = function () {\n    if (!this.content) {\n      return;\n    }\n    var style = this.visible() ? '' : 'none';\n    this.content.style.display = style;\n  };\n  Stage.prototype.setContainer = function (container) {\n    if (typeof container === STRING) {\n      if (container.charAt(0) === '.') {\n        var className = container.slice(1);\n        container = document.getElementsByClassName(className)[0];\n      } else {\n        var id;\n        if (container.charAt(0) !== '#') {\n          id = container;\n        } else {\n          id = container.slice(1);\n        }\n        container = document.getElementById(id);\n      }\n      if (!container) {\n        throw 'Can not find container in document with id ' + id;\n      }\n    }\n    this._setAttr(CONTAINER, container);\n    if (this.content) {\n      if (this.content.parentElement) {\n        this.content.parentElement.removeChild(this.content);\n      }\n      container.appendChild(this.content);\n    }\n    return this;\n  };\n  Stage.prototype.shouldDrawHit = function () {\n    return true;\n  };\n  Stage.prototype.clear = function () {\n    var layers = this.children,\n      len = layers.length,\n      n;\n    for (n = 0; n < len; n++) {\n      layers[n].clear();\n    }\n    return this;\n  };\n  Stage.prototype.clone = function (obj) {\n    if (!obj) {\n      obj = {};\n    }\n    obj.container = document.createElement('div');\n    return Container_1.Container.prototype.clone.call(this, obj);\n  };\n  Stage.prototype.destroy = function () {\n    _super.prototype.destroy.call(this);\n    var content = this.content;\n    if (content && Util_1.Util._isInDocument(content)) {\n      this.container().removeChild(content);\n    }\n    var index = exports.stages.indexOf(this);\n    if (index > -1) {\n      exports.stages.splice(index, 1);\n    }\n    return this;\n  };\n  Stage.prototype.getPointerPosition = function () {\n    var pos = this._pointerPositions[0] || this._changedPointerPositions[0];\n    if (!pos) {\n      Util_1.Util.warn(NO_POINTERS_MESSAGE);\n      return null;\n    }\n    return {\n      x: pos.x,\n      y: pos.y\n    };\n  };\n  Stage.prototype._getPointerById = function (id) {\n    return this._pointerPositions.find(function (p) {\n      return p.id === id;\n    });\n  };\n  Stage.prototype.getPointersPositions = function () {\n    return this._pointerPositions;\n  };\n  Stage.prototype.getStage = function () {\n    return this;\n  };\n  Stage.prototype.getContent = function () {\n    return this.content;\n  };\n  Stage.prototype._toKonvaCanvas = function (config) {\n    config = config || {};\n    config.x = config.x || 0;\n    config.y = config.y || 0;\n    config.width = config.width || this.width();\n    config.height = config.height || this.height();\n    var canvas = new Canvas_1.SceneCanvas({\n      width: config.width,\n      height: config.height,\n      pixelRatio: config.pixelRatio || 1\n    });\n    var _context = canvas.getContext()._context;\n    var layers = this.children;\n    if (config.x || config.y) {\n      _context.translate(-1 * config.x, -1 * config.y);\n    }\n    layers.each(function (layer) {\n      if (!layer.isVisible()) {\n        return;\n      }\n      var layerCanvas = layer._toKonvaCanvas(config);\n      _context.drawImage(layerCanvas._canvas, config.x, config.y, layerCanvas.getWidth() / layerCanvas.getPixelRatio(), layerCanvas.getHeight() / layerCanvas.getPixelRatio());\n    });\n    return canvas;\n  };\n  Stage.prototype.getIntersection = function (pos, selector) {\n    if (!pos) {\n      return null;\n    }\n    var layers = this.children,\n      len = layers.length,\n      end = len - 1,\n      n,\n      shape;\n    for (n = end; n >= 0; n--) {\n      shape = layers[n].getIntersection(pos, selector);\n      if (shape) {\n        return shape;\n      }\n    }\n    return null;\n  };\n  Stage.prototype._resizeDOM = function () {\n    var width = this.width();\n    var height = this.height();\n    if (this.content) {\n      this.content.style.width = width + PX;\n      this.content.style.height = height + PX;\n    }\n    this.bufferCanvas.setSize(width, height);\n    this.bufferHitCanvas.setSize(width, height);\n    this.children.each(function (layer) {\n      layer.setSize({\n        width: width,\n        height: height\n      });\n      layer.draw();\n    });\n  };\n  Stage.prototype.add = function (layer) {\n    if (arguments.length > 1) {\n      for (var i = 0; i < arguments.length; i++) {\n        this.add(arguments[i]);\n      }\n      return this;\n    }\n    _super.prototype.add.call(this, layer);\n    var length = this.children.length;\n    if (length > MAX_LAYERS_NUMBER) {\n      Util_1.Util.warn('The stage has ' + length + ' layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.');\n    }\n    layer.setSize({\n      width: this.width(),\n      height: this.height()\n    });\n    layer.draw();\n    if (Global_1.Konva.isBrowser) {\n      this.content.appendChild(layer.canvas._canvas);\n    }\n    return this;\n  };\n  Stage.prototype.getParent = function () {\n    return null;\n  };\n  Stage.prototype.getLayer = function () {\n    return null;\n  };\n  Stage.prototype.hasPointerCapture = function (pointerId) {\n    return PointerEvents.hasPointerCapture(pointerId, this);\n  };\n  Stage.prototype.setPointerCapture = function (pointerId) {\n    PointerEvents.setPointerCapture(pointerId, this);\n  };\n  Stage.prototype.releaseCapture = function (pointerId) {\n    PointerEvents.releaseCapture(pointerId, this);\n  };\n  Stage.prototype.getLayers = function () {\n    return this.getChildren();\n  };\n  Stage.prototype._bindContentEvents = function () {\n    if (!Global_1.Konva.isBrowser) {\n      return;\n    }\n    for (var n = 0; n < eventsLength; n++) {\n      addEvent(this, EVENTS[n]);\n    }\n  };\n  Stage.prototype._mouseenter = function (evt) {\n    this.setPointersPositions(evt);\n    this._fire(MOUSEENTER, {\n      evt: evt,\n      target: this,\n      currentTarget: this\n    });\n  };\n  Stage.prototype._mouseover = function (evt) {\n    this.setPointersPositions(evt);\n    this._fire(CONTENT_MOUSEOVER, {\n      evt: evt\n    });\n    this._fire(MOUSEOVER, {\n      evt: evt,\n      target: this,\n      currentTarget: this\n    });\n  };\n  Stage.prototype._mouseleave = function (evt) {\n    var _a;\n    this.setPointersPositions(evt);\n    var targetShape = ((_a = this.targetShape) === null || _a === void 0 ? void 0 : _a.getStage()) ? this.targetShape : null;\n    var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n    if (targetShape && eventsEnabled) {\n      targetShape._fireAndBubble(MOUSEOUT, {\n        evt: evt\n      });\n      targetShape._fireAndBubble(MOUSELEAVE, {\n        evt: evt\n      });\n      this._fire(MOUSELEAVE, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n      this.targetShape = null;\n    } else if (eventsEnabled) {\n      this._fire(MOUSELEAVE, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n      this._fire(MOUSEOUT, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n    this.pointerPos = undefined;\n    this._pointerPositions = [];\n    this._fire(CONTENT_MOUSEOUT, {\n      evt: evt\n    });\n  };\n  Stage.prototype._mousemove = function (evt) {\n    var _a;\n    if (Global_1.Konva.UA.ieMobile) {\n      return this._touchmove(evt);\n    }\n    this.setPointersPositions(evt);\n    var pointerId = Util_1.Util._getFirstPointerId(evt);\n    var shape;\n    var targetShape = ((_a = this.targetShape) === null || _a === void 0 ? void 0 : _a.getStage()) ? this.targetShape : null;\n    var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n    if (eventsEnabled) {\n      shape = this.getIntersection(this.getPointerPosition());\n      if (shape && shape.isListening()) {\n        var differentTarget = targetShape !== shape;\n        if (eventsEnabled && differentTarget) {\n          if (targetShape) {\n            targetShape._fireAndBubble(MOUSEOUT, {\n              evt: evt,\n              pointerId: pointerId\n            }, shape);\n            targetShape._fireAndBubble(MOUSELEAVE, {\n              evt: evt,\n              pointerId: pointerId\n            }, shape);\n          }\n          shape._fireAndBubble(MOUSEOVER, {\n            evt: evt,\n            pointerId: pointerId\n          }, targetShape);\n          shape._fireAndBubble(MOUSEENTER, {\n            evt: evt,\n            pointerId: pointerId\n          }, targetShape);\n          shape._fireAndBubble(MOUSEMOVE, {\n            evt: evt,\n            pointerId: pointerId\n          });\n          this.targetShape = shape;\n        } else {\n          shape._fireAndBubble(MOUSEMOVE, {\n            evt: evt,\n            pointerId: pointerId\n          });\n        }\n      } else {\n        if (targetShape && eventsEnabled) {\n          targetShape._fireAndBubble(MOUSEOUT, {\n            evt: evt,\n            pointerId: pointerId\n          });\n          targetShape._fireAndBubble(MOUSELEAVE, {\n            evt: evt,\n            pointerId: pointerId\n          });\n          this._fire(MOUSEOVER, {\n            evt: evt,\n            target: this,\n            currentTarget: this,\n            pointerId: pointerId\n          });\n          this.targetShape = null;\n        }\n        this._fire(MOUSEMOVE, {\n          evt: evt,\n          target: this,\n          currentTarget: this,\n          pointerId: pointerId\n        });\n      }\n      this._fire(CONTENT_MOUSEMOVE, {\n        evt: evt\n      });\n    }\n    if (evt.cancelable) {\n      evt.preventDefault();\n    }\n  };\n  Stage.prototype._mousedown = function (evt) {\n    if (Global_1.Konva.UA.ieMobile) {\n      return this._touchstart(evt);\n    }\n    this.setPointersPositions(evt);\n    var pointerId = Util_1.Util._getFirstPointerId(evt);\n    var shape = this.getIntersection(this.getPointerPosition());\n    DragAndDrop_1.DD.justDragged = false;\n    Global_1.Konva.listenClickTap = true;\n    if (shape && shape.isListening()) {\n      this.clickStartShape = shape;\n      shape._fireAndBubble(MOUSEDOWN, {\n        evt: evt,\n        pointerId: pointerId\n      });\n    } else {\n      this._fire(MOUSEDOWN, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: pointerId\n      });\n    }\n    this._fire(CONTENT_MOUSEDOWN, {\n      evt: evt\n    });\n  };\n  Stage.prototype._mouseup = function (evt) {\n    if (Global_1.Konva.UA.ieMobile) {\n      return this._touchend(evt);\n    }\n    this.setPointersPositions(evt);\n    var pointerId = Util_1.Util._getFirstPointerId(evt);\n    var shape = this.getIntersection(this.getPointerPosition()),\n      clickStartShape = this.clickStartShape,\n      clickEndShape = this.clickEndShape,\n      fireDblClick = false;\n    if (Global_1.Konva.inDblClickWindow) {\n      fireDblClick = true;\n      clearTimeout(this.dblTimeout);\n    } else if (!DragAndDrop_1.DD.justDragged) {\n      Global_1.Konva.inDblClickWindow = true;\n      clearTimeout(this.dblTimeout);\n    }\n    this.dblTimeout = setTimeout(function () {\n      Global_1.Konva.inDblClickWindow = false;\n    }, Global_1.Konva.dblClickWindow);\n    if (shape && shape.isListening()) {\n      this.clickEndShape = shape;\n      shape._fireAndBubble(MOUSEUP, {\n        evt: evt,\n        pointerId: pointerId\n      });\n      if (Global_1.Konva.listenClickTap && clickStartShape && clickStartShape._id === shape._id) {\n        shape._fireAndBubble(CLICK, {\n          evt: evt,\n          pointerId: pointerId\n        });\n        if (fireDblClick && clickEndShape && clickEndShape === shape) {\n          shape._fireAndBubble(DBL_CLICK, {\n            evt: evt,\n            pointerId: pointerId\n          });\n        }\n      }\n    } else {\n      this.clickEndShape = null;\n      this._fire(MOUSEUP, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: pointerId\n      });\n      if (Global_1.Konva.listenClickTap) {\n        this._fire(CLICK, {\n          evt: evt,\n          target: this,\n          currentTarget: this,\n          pointerId: pointerId\n        });\n      }\n      if (fireDblClick) {\n        this._fire(DBL_CLICK, {\n          evt: evt,\n          target: this,\n          currentTarget: this,\n          pointerId: pointerId\n        });\n      }\n    }\n    this._fire(CONTENT_MOUSEUP, {\n      evt: evt\n    });\n    if (Global_1.Konva.listenClickTap) {\n      this._fire(CONTENT_CLICK, {\n        evt: evt\n      });\n      if (fireDblClick) {\n        this._fire(CONTENT_DBL_CLICK, {\n          evt: evt\n        });\n      }\n    }\n    Global_1.Konva.listenClickTap = false;\n    if (evt.cancelable) {\n      evt.preventDefault();\n    }\n  };\n  Stage.prototype._contextmenu = function (evt) {\n    this.setPointersPositions(evt);\n    var shape = this.getIntersection(this.getPointerPosition());\n    if (shape && shape.isListening()) {\n      shape._fireAndBubble(CONTEXTMENU, {\n        evt: evt\n      });\n    } else {\n      this._fire(CONTEXTMENU, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n    this._fire(CONTENT_CONTEXTMENU, {\n      evt: evt\n    });\n  };\n  Stage.prototype._touchstart = function (evt) {\n    var _this = this;\n    this.setPointersPositions(evt);\n    var triggeredOnShape = false;\n    this._changedPointerPositions.forEach(function (pos) {\n      var shape = _this.getIntersection(pos);\n      Global_1.Konva.listenClickTap = true;\n      DragAndDrop_1.DD.justDragged = false;\n      var hasShape = shape && shape.isListening();\n      if (!hasShape) {\n        return;\n      }\n      if (Global_1.Konva.captureTouchEventsEnabled) {\n        shape.setPointerCapture(pos.id);\n      }\n      _this.tapStartShape = shape;\n      shape._fireAndBubble(TOUCHSTART, {\n        evt: evt,\n        pointerId: pos.id\n      }, _this);\n      triggeredOnShape = true;\n      if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n        evt.preventDefault();\n      }\n    });\n    if (!triggeredOnShape) {\n      this._fire(TOUCHSTART, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._changedPointerPositions[0].id\n      });\n    }\n    this._fire(CONTENT_TOUCHSTART, {\n      evt: evt\n    });\n  };\n  Stage.prototype._touchmove = function (evt) {\n    var _this = this;\n    this.setPointersPositions(evt);\n    var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n    if (eventsEnabled) {\n      var triggeredOnShape = false;\n      var processedShapesIds = {};\n      this._changedPointerPositions.forEach(function (pos) {\n        var shape = PointerEvents.getCapturedShape(pos.id) || _this.getIntersection(pos);\n        var hasShape = shape && shape.isListening();\n        if (!hasShape) {\n          return;\n        }\n        if (processedShapesIds[shape._id]) {\n          return;\n        }\n        processedShapesIds[shape._id] = true;\n        shape._fireAndBubble(TOUCHMOVE, {\n          evt: evt,\n          pointerId: pos.id\n        });\n        triggeredOnShape = true;\n        if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n          evt.preventDefault();\n        }\n      });\n      if (!triggeredOnShape) {\n        this._fire(TOUCHMOVE, {\n          evt: evt,\n          target: this,\n          currentTarget: this,\n          pointerId: this._changedPointerPositions[0].id\n        });\n      }\n      this._fire(CONTENT_TOUCHMOVE, {\n        evt: evt\n      });\n    }\n    if (DragAndDrop_1.DD.isDragging && DragAndDrop_1.DD.node.preventDefault() && evt.cancelable) {\n      evt.preventDefault();\n    }\n  };\n  Stage.prototype._touchend = function (evt) {\n    var _this = this;\n    this.setPointersPositions(evt);\n    var tapEndShape = this.tapEndShape,\n      fireDblClick = false;\n    if (Global_1.Konva.inDblClickWindow) {\n      fireDblClick = true;\n      clearTimeout(this.dblTimeout);\n    } else if (!DragAndDrop_1.DD.justDragged) {\n      Global_1.Konva.inDblClickWindow = true;\n      clearTimeout(this.dblTimeout);\n    }\n    this.dblTimeout = setTimeout(function () {\n      Global_1.Konva.inDblClickWindow = false;\n    }, Global_1.Konva.dblClickWindow);\n    var triggeredOnShape = false;\n    var processedShapesIds = {};\n    var tapTriggered = false;\n    var dblTapTriggered = false;\n    this._changedPointerPositions.forEach(function (pos) {\n      var shape = PointerEvents.getCapturedShape(pos.id) || _this.getIntersection(pos);\n      if (shape) {\n        shape.releaseCapture(pos.id);\n      }\n      var hasShape = shape && shape.isListening();\n      if (!hasShape) {\n        return;\n      }\n      if (processedShapesIds[shape._id]) {\n        return;\n      }\n      processedShapesIds[shape._id] = true;\n      _this.tapEndShape = shape;\n      shape._fireAndBubble(TOUCHEND, {\n        evt: evt,\n        pointerId: pos.id\n      });\n      triggeredOnShape = true;\n      if (Global_1.Konva.listenClickTap && shape === _this.tapStartShape) {\n        tapTriggered = true;\n        shape._fireAndBubble(TAP, {\n          evt: evt,\n          pointerId: pos.id\n        });\n        if (fireDblClick && tapEndShape && tapEndShape === shape) {\n          dblTapTriggered = true;\n          shape._fireAndBubble(DBL_TAP, {\n            evt: evt,\n            pointerId: pos.id\n          });\n        }\n      }\n      if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n        evt.preventDefault();\n      }\n    });\n    if (!triggeredOnShape) {\n      this._fire(TOUCHEND, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._changedPointerPositions[0].id\n      });\n    }\n    if (Global_1.Konva.listenClickTap && !tapTriggered) {\n      this.tapEndShape = null;\n      this._fire(TAP, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._changedPointerPositions[0].id\n      });\n    }\n    if (fireDblClick && !dblTapTriggered) {\n      this._fire(DBL_TAP, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._changedPointerPositions[0].id\n      });\n    }\n    this._fire(CONTENT_TOUCHEND, {\n      evt: evt\n    });\n    if (Global_1.Konva.listenClickTap) {\n      this._fire(CONTENT_TAP, {\n        evt: evt\n      });\n      if (fireDblClick) {\n        this._fire(CONTENT_DBL_TAP, {\n          evt: evt\n        });\n      }\n    }\n    if (this.preventDefault() && evt.cancelable) {\n      evt.preventDefault();\n    }\n    Global_1.Konva.listenClickTap = false;\n  };\n  Stage.prototype._wheel = function (evt) {\n    this.setPointersPositions(evt);\n    var shape = this.getIntersection(this.getPointerPosition());\n    if (shape && shape.isListening()) {\n      shape._fireAndBubble(WHEEL, {\n        evt: evt\n      });\n    } else {\n      this._fire(WHEEL, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n    this._fire(CONTENT_WHEEL, {\n      evt: evt\n    });\n  };\n  Stage.prototype._pointerdown = function (evt) {\n    if (!Global_1.Konva._pointerEventsEnabled) {\n      return;\n    }\n    this.setPointersPositions(evt);\n    var shape = PointerEvents.getCapturedShape(evt.pointerId) || this.getIntersection(this.getPointerPosition());\n    if (shape) {\n      shape._fireAndBubble(POINTERDOWN, PointerEvents.createEvent(evt));\n    }\n  };\n  Stage.prototype._pointermove = function (evt) {\n    if (!Global_1.Konva._pointerEventsEnabled) {\n      return;\n    }\n    this.setPointersPositions(evt);\n    var shape = PointerEvents.getCapturedShape(evt.pointerId) || this.getIntersection(this.getPointerPosition());\n    if (shape) {\n      shape._fireAndBubble(POINTERMOVE, PointerEvents.createEvent(evt));\n    }\n  };\n  Stage.prototype._pointerup = function (evt) {\n    if (!Global_1.Konva._pointerEventsEnabled) {\n      return;\n    }\n    this.setPointersPositions(evt);\n    var shape = PointerEvents.getCapturedShape(evt.pointerId) || this.getIntersection(this.getPointerPosition());\n    if (shape) {\n      shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n    }\n    PointerEvents.releaseCapture(evt.pointerId);\n  };\n  Stage.prototype._pointercancel = function (evt) {\n    if (!Global_1.Konva._pointerEventsEnabled) {\n      return;\n    }\n    this.setPointersPositions(evt);\n    var shape = PointerEvents.getCapturedShape(evt.pointerId) || this.getIntersection(this.getPointerPosition());\n    if (shape) {\n      shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n    }\n    PointerEvents.releaseCapture(evt.pointerId);\n  };\n  Stage.prototype._lostpointercapture = function (evt) {\n    PointerEvents.releaseCapture(evt.pointerId);\n  };\n  Stage.prototype.setPointersPositions = function (evt) {\n    var _this = this;\n    var contentPosition = this._getContentPosition(),\n      x = null,\n      y = null;\n    evt = evt ? evt : window.event;\n    if (evt.touches !== undefined) {\n      this._pointerPositions = [];\n      this._changedPointerPositions = [];\n      Util_1.Collection.prototype.each.call(evt.touches, function (touch) {\n        _this._pointerPositions.push({\n          id: touch.identifier,\n          x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n          y: (touch.clientY - contentPosition.top) / contentPosition.scaleY\n        });\n      });\n      Util_1.Collection.prototype.each.call(evt.changedTouches || evt.touches, function (touch) {\n        _this._changedPointerPositions.push({\n          id: touch.identifier,\n          x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n          y: (touch.clientY - contentPosition.top) / contentPosition.scaleY\n        });\n      });\n    } else {\n      x = (evt.clientX - contentPosition.left) / contentPosition.scaleX;\n      y = (evt.clientY - contentPosition.top) / contentPosition.scaleY;\n      this.pointerPos = {\n        x: x,\n        y: y\n      };\n      this._pointerPositions = [{\n        x: x,\n        y: y,\n        id: Util_1.Util._getFirstPointerId(evt)\n      }];\n      this._changedPointerPositions = [{\n        x: x,\n        y: y,\n        id: Util_1.Util._getFirstPointerId(evt)\n      }];\n    }\n  };\n  Stage.prototype._setPointerPosition = function (evt) {\n    Util_1.Util.warn('Method _setPointerPosition is deprecated. Use \"stage.setPointersPositions(event)\" instead.');\n    this.setPointersPositions(evt);\n  };\n  Stage.prototype._getContentPosition = function () {\n    if (!this.content || !this.content.getBoundingClientRect) {\n      return {\n        top: 0,\n        left: 0,\n        scaleX: 1,\n        scaleY: 1\n      };\n    }\n    var rect = this.content.getBoundingClientRect();\n    return {\n      top: rect.top,\n      left: rect.left,\n      scaleX: rect.width / this.content.clientWidth || 1,\n      scaleY: rect.height / this.content.clientHeight || 1\n    };\n  };\n  Stage.prototype._buildDOM = function () {\n    this.bufferCanvas = new Canvas_1.SceneCanvas({\n      width: this.width(),\n      height: this.height()\n    });\n    this.bufferHitCanvas = new Canvas_1.HitCanvas({\n      pixelRatio: 1,\n      width: this.width(),\n      height: this.height()\n    });\n    if (!Global_1.Konva.isBrowser) {\n      return;\n    }\n    var container = this.container();\n    if (!container) {\n      throw 'Stage has no container. A container is required.';\n    }\n    container.innerHTML = EMPTY_STRING;\n    this.content = document.createElement('div');\n    this.content.style.position = RELATIVE;\n    this.content.style.userSelect = 'none';\n    this.content.className = KONVA_CONTENT;\n    this.content.setAttribute('role', 'presentation');\n    container.appendChild(this.content);\n    this._resizeDOM();\n  };\n  Stage.prototype.cache = function () {\n    Util_1.Util.warn('Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.');\n    return this;\n  };\n  Stage.prototype.clearCache = function () {\n    return this;\n  };\n  Stage.prototype.batchDraw = function () {\n    this.children.each(function (layer) {\n      layer.batchDraw();\n    });\n    return this;\n  };\n  return Stage;\n}(Container_1.Container);\nexports.Stage = Stage;\nStage.prototype.nodeType = STAGE;\nGlobal_2._registerNode(Stage);\nFactory_1.Factory.addGetterSetter(Stage, 'container');","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","defineProperty","exports","value","Stage","stages","Util_1","require","Factory_1","Container_1","Global_1","Canvas_1","DragAndDrop_1","Global_2","PointerEvents","STAGE","STRING","PX","MOUSEOUT","MOUSELEAVE","MOUSEOVER","MOUSEENTER","MOUSEMOVE","MOUSEDOWN","MOUSEUP","POINTERMOVE","POINTERDOWN","POINTERUP","POINTERCANCEL","LOSTPOINTERCAPTURE","CONTEXTMENU","CLICK","DBL_CLICK","TOUCHSTART","TOUCHEND","TAP","DBL_TAP","TOUCHMOVE","WHEEL","CONTENT_MOUSEOUT","CONTENT_MOUSEOVER","CONTENT_MOUSEMOVE","CONTENT_MOUSEDOWN","CONTENT_MOUSEUP","CONTENT_CONTEXTMENU","CONTENT_CLICK","CONTENT_DBL_CLICK","CONTENT_TOUCHSTART","CONTENT_TOUCHEND","CONTENT_DBL_TAP","CONTENT_TAP","CONTENT_TOUCHMOVE","CONTENT_POINTERMOVE","CONTENT_POINTERDOWN","CONTENT_POINTERUP","CONTENT_WHEEL","RELATIVE","KONVA_CONTENT","SPACE","UNDERSCORE","CONTAINER","MAX_LAYERS_NUMBER","EMPTY_STRING","EVENTS","eventsLength","length","addEvent","ctx","eventName","content","addEventListener","evt","NO_POINTERS_MESSAGE","checkNoClip","attrs","clipFunc","clipWidth","clipHeight","Util","warn","_super","config","_this","_pointerPositions","_changedPointerPositions","_buildDOM","_bindContentEvents","push","on","_resizeDOM","_checkVisibility","_validateAdd","child","isLayer","getType","isFastLayer","valid","throw","style","visible","display","setContainer","container","charAt","className","slice","document","getElementsByClassName","id","getElementById","_setAttr","parentElement","removeChild","appendChild","shouldDrawHit","clear","layers","children","len","n","clone","obj","createElement","Container","destroy","_isInDocument","index","indexOf","splice","getPointerPosition","pos","x","y","_getPointerById","find","getPointersPositions","getStage","getContent","_toKonvaCanvas","width","height","canvas","SceneCanvas","pixelRatio","_context","getContext","translate","each","layer","isVisible","layerCanvas","drawImage","_canvas","getWidth","getPixelRatio","getHeight","getIntersection","selector","end","shape","bufferCanvas","setSize","bufferHitCanvas","draw","add","arguments","i","Konva","isBrowser","getParent","getLayer","hasPointerCapture","pointerId","setPointerCapture","releaseCapture","getLayers","getChildren","_mouseenter","setPointersPositions","_fire","target","currentTarget","_mouseover","_mouseleave","_a","targetShape","eventsEnabled","DD","isDragging","hitOnDragEnabled","_fireAndBubble","pointerPos","undefined","_mousemove","UA","ieMobile","_touchmove","_getFirstPointerId","isListening","differentTarget","cancelable","preventDefault","_mousedown","_touchstart","justDragged","listenClickTap","clickStartShape","_mouseup","_touchend","clickEndShape","fireDblClick","inDblClickWindow","clearTimeout","dblTimeout","setTimeout","dblClickWindow","_id","_contextmenu","triggeredOnShape","forEach","hasShape","captureTouchEventsEnabled","tapStartShape","processedShapesIds","getCapturedShape","node","tapEndShape","tapTriggered","dblTapTriggered","_wheel","_pointerdown","_pointerEventsEnabled","createEvent","_pointermove","_pointerup","_pointercancel","_lostpointercapture","contentPosition","_getContentPosition","window","event","touches","Collection","touch","identifier","clientX","left","scaleX","clientY","top","scaleY","changedTouches","_setPointerPosition","getBoundingClientRect","rect","clientWidth","clientHeight","HitCanvas","innerHTML","position","userSelect","setAttribute","cache","clearCache","batchDraw","nodeType","_registerNode","Factory","addGetterSetter"],"sources":["/Users/UX201446/Documents/GitHub/konva/node_modules/konva/lib/Stage.js"],"sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Stage = exports.stages = void 0;\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Container_1 = require(\"./Container\");\nvar Global_1 = require(\"./Global\");\nvar Canvas_1 = require(\"./Canvas\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Global_2 = require(\"./Global\");\nvar PointerEvents = require(\"./PointerEvents\");\nvar STAGE = 'Stage', STRING = 'string', PX = 'px', MOUSEOUT = 'mouseout', MOUSELEAVE = 'mouseleave', MOUSEOVER = 'mouseover', MOUSEENTER = 'mouseenter', MOUSEMOVE = 'mousemove', MOUSEDOWN = 'mousedown', MOUSEUP = 'mouseup', POINTERMOVE = 'pointermove', POINTERDOWN = 'pointerdown', POINTERUP = 'pointerup', POINTERCANCEL = 'pointercancel', LOSTPOINTERCAPTURE = 'lostpointercapture', CONTEXTMENU = 'contextmenu', CLICK = 'click', DBL_CLICK = 'dblclick', TOUCHSTART = 'touchstart', TOUCHEND = 'touchend', TAP = 'tap', DBL_TAP = 'dbltap', TOUCHMOVE = 'touchmove', WHEEL = 'wheel', CONTENT_MOUSEOUT = 'contentMouseout', CONTENT_MOUSEOVER = 'contentMouseover', CONTENT_MOUSEMOVE = 'contentMousemove', CONTENT_MOUSEDOWN = 'contentMousedown', CONTENT_MOUSEUP = 'contentMouseup', CONTENT_CONTEXTMENU = 'contentContextmenu', CONTENT_CLICK = 'contentClick', CONTENT_DBL_CLICK = 'contentDblclick', CONTENT_TOUCHSTART = 'contentTouchstart', CONTENT_TOUCHEND = 'contentTouchend', CONTENT_DBL_TAP = 'contentDbltap', CONTENT_TAP = 'contentTap', CONTENT_TOUCHMOVE = 'contentTouchmove', CONTENT_POINTERMOVE = 'contentPointermove', CONTENT_POINTERDOWN = 'contentPointerdown', CONTENT_POINTERUP = 'contentPointerup', CONTENT_WHEEL = 'contentWheel', RELATIVE = 'relative', KONVA_CONTENT = 'konvajs-content', SPACE = ' ', UNDERSCORE = '_', CONTAINER = 'container', MAX_LAYERS_NUMBER = 5, EMPTY_STRING = '', EVENTS = [\n    MOUSEENTER,\n    MOUSEDOWN,\n    MOUSEMOVE,\n    MOUSEUP,\n    MOUSELEAVE,\n    TOUCHSTART,\n    TOUCHMOVE,\n    TOUCHEND,\n    MOUSEOVER,\n    WHEEL,\n    CONTEXTMENU,\n    POINTERDOWN,\n    POINTERMOVE,\n    POINTERUP,\n    POINTERCANCEL,\n    LOSTPOINTERCAPTURE,\n], eventsLength = EVENTS.length;\nfunction addEvent(ctx, eventName) {\n    ctx.content.addEventListener(eventName, function (evt) {\n        ctx[UNDERSCORE + eventName](evt);\n    }, false);\n}\nvar NO_POINTERS_MESSAGE = \"Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);\";\nexports.stages = [];\nfunction checkNoClip(attrs) {\n    if (attrs === void 0) { attrs = {}; }\n    if (attrs.clipFunc || attrs.clipWidth || attrs.clipHeight) {\n        Util_1.Util.warn('Stage does not support clipping. Please use clip for Layers or Groups.');\n    }\n    return attrs;\n}\nvar Stage = (function (_super) {\n    __extends(Stage, _super);\n    function Stage(config) {\n        var _this = _super.call(this, checkNoClip(config)) || this;\n        _this._pointerPositions = [];\n        _this._changedPointerPositions = [];\n        _this._buildDOM();\n        _this._bindContentEvents();\n        exports.stages.push(_this);\n        _this.on('widthChange.konva heightChange.konva', _this._resizeDOM);\n        _this.on('visibleChange.konva', _this._checkVisibility);\n        _this.on('clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva', function () {\n            checkNoClip(_this.attrs);\n        });\n        _this._checkVisibility();\n        return _this;\n    }\n    Stage.prototype._validateAdd = function (child) {\n        var isLayer = child.getType() === 'Layer';\n        var isFastLayer = child.getType() === 'FastLayer';\n        var valid = isLayer || isFastLayer;\n        if (!valid) {\n            Util_1.Util.throw('You may only add layers to the stage.');\n        }\n    };\n    Stage.prototype._checkVisibility = function () {\n        if (!this.content) {\n            return;\n        }\n        var style = this.visible() ? '' : 'none';\n        this.content.style.display = style;\n    };\n    Stage.prototype.setContainer = function (container) {\n        if (typeof container === STRING) {\n            if (container.charAt(0) === '.') {\n                var className = container.slice(1);\n                container = document.getElementsByClassName(className)[0];\n            }\n            else {\n                var id;\n                if (container.charAt(0) !== '#') {\n                    id = container;\n                }\n                else {\n                    id = container.slice(1);\n                }\n                container = document.getElementById(id);\n            }\n            if (!container) {\n                throw 'Can not find container in document with id ' + id;\n            }\n        }\n        this._setAttr(CONTAINER, container);\n        if (this.content) {\n            if (this.content.parentElement) {\n                this.content.parentElement.removeChild(this.content);\n            }\n            container.appendChild(this.content);\n        }\n        return this;\n    };\n    Stage.prototype.shouldDrawHit = function () {\n        return true;\n    };\n    Stage.prototype.clear = function () {\n        var layers = this.children, len = layers.length, n;\n        for (n = 0; n < len; n++) {\n            layers[n].clear();\n        }\n        return this;\n    };\n    Stage.prototype.clone = function (obj) {\n        if (!obj) {\n            obj = {};\n        }\n        obj.container = document.createElement('div');\n        return Container_1.Container.prototype.clone.call(this, obj);\n    };\n    Stage.prototype.destroy = function () {\n        _super.prototype.destroy.call(this);\n        var content = this.content;\n        if (content && Util_1.Util._isInDocument(content)) {\n            this.container().removeChild(content);\n        }\n        var index = exports.stages.indexOf(this);\n        if (index > -1) {\n            exports.stages.splice(index, 1);\n        }\n        return this;\n    };\n    Stage.prototype.getPointerPosition = function () {\n        var pos = this._pointerPositions[0] || this._changedPointerPositions[0];\n        if (!pos) {\n            Util_1.Util.warn(NO_POINTERS_MESSAGE);\n            return null;\n        }\n        return {\n            x: pos.x,\n            y: pos.y,\n        };\n    };\n    Stage.prototype._getPointerById = function (id) {\n        return this._pointerPositions.find(function (p) { return p.id === id; });\n    };\n    Stage.prototype.getPointersPositions = function () {\n        return this._pointerPositions;\n    };\n    Stage.prototype.getStage = function () {\n        return this;\n    };\n    Stage.prototype.getContent = function () {\n        return this.content;\n    };\n    Stage.prototype._toKonvaCanvas = function (config) {\n        config = config || {};\n        config.x = config.x || 0;\n        config.y = config.y || 0;\n        config.width = config.width || this.width();\n        config.height = config.height || this.height();\n        var canvas = new Canvas_1.SceneCanvas({\n            width: config.width,\n            height: config.height,\n            pixelRatio: config.pixelRatio || 1,\n        });\n        var _context = canvas.getContext()._context;\n        var layers = this.children;\n        if (config.x || config.y) {\n            _context.translate(-1 * config.x, -1 * config.y);\n        }\n        layers.each(function (layer) {\n            if (!layer.isVisible()) {\n                return;\n            }\n            var layerCanvas = layer._toKonvaCanvas(config);\n            _context.drawImage(layerCanvas._canvas, config.x, config.y, layerCanvas.getWidth() / layerCanvas.getPixelRatio(), layerCanvas.getHeight() / layerCanvas.getPixelRatio());\n        });\n        return canvas;\n    };\n    Stage.prototype.getIntersection = function (pos, selector) {\n        if (!pos) {\n            return null;\n        }\n        var layers = this.children, len = layers.length, end = len - 1, n, shape;\n        for (n = end; n >= 0; n--) {\n            shape = layers[n].getIntersection(pos, selector);\n            if (shape) {\n                return shape;\n            }\n        }\n        return null;\n    };\n    Stage.prototype._resizeDOM = function () {\n        var width = this.width();\n        var height = this.height();\n        if (this.content) {\n            this.content.style.width = width + PX;\n            this.content.style.height = height + PX;\n        }\n        this.bufferCanvas.setSize(width, height);\n        this.bufferHitCanvas.setSize(width, height);\n        this.children.each(function (layer) {\n            layer.setSize({ width: width, height: height });\n            layer.draw();\n        });\n    };\n    Stage.prototype.add = function (layer) {\n        if (arguments.length > 1) {\n            for (var i = 0; i < arguments.length; i++) {\n                this.add(arguments[i]);\n            }\n            return this;\n        }\n        _super.prototype.add.call(this, layer);\n        var length = this.children.length;\n        if (length > MAX_LAYERS_NUMBER) {\n            Util_1.Util.warn('The stage has ' +\n                length +\n                ' layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.');\n        }\n        layer.setSize({ width: this.width(), height: this.height() });\n        layer.draw();\n        if (Global_1.Konva.isBrowser) {\n            this.content.appendChild(layer.canvas._canvas);\n        }\n        return this;\n    };\n    Stage.prototype.getParent = function () {\n        return null;\n    };\n    Stage.prototype.getLayer = function () {\n        return null;\n    };\n    Stage.prototype.hasPointerCapture = function (pointerId) {\n        return PointerEvents.hasPointerCapture(pointerId, this);\n    };\n    Stage.prototype.setPointerCapture = function (pointerId) {\n        PointerEvents.setPointerCapture(pointerId, this);\n    };\n    Stage.prototype.releaseCapture = function (pointerId) {\n        PointerEvents.releaseCapture(pointerId, this);\n    };\n    Stage.prototype.getLayers = function () {\n        return this.getChildren();\n    };\n    Stage.prototype._bindContentEvents = function () {\n        if (!Global_1.Konva.isBrowser) {\n            return;\n        }\n        for (var n = 0; n < eventsLength; n++) {\n            addEvent(this, EVENTS[n]);\n        }\n    };\n    Stage.prototype._mouseenter = function (evt) {\n        this.setPointersPositions(evt);\n        this._fire(MOUSEENTER, { evt: evt, target: this, currentTarget: this });\n    };\n    Stage.prototype._mouseover = function (evt) {\n        this.setPointersPositions(evt);\n        this._fire(CONTENT_MOUSEOVER, { evt: evt });\n        this._fire(MOUSEOVER, { evt: evt, target: this, currentTarget: this });\n    };\n    Stage.prototype._mouseleave = function (evt) {\n        var _a;\n        this.setPointersPositions(evt);\n        var targetShape = ((_a = this.targetShape) === null || _a === void 0 ? void 0 : _a.getStage()) ? this.targetShape : null;\n        var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n        if (targetShape && eventsEnabled) {\n            targetShape._fireAndBubble(MOUSEOUT, { evt: evt });\n            targetShape._fireAndBubble(MOUSELEAVE, { evt: evt });\n            this._fire(MOUSELEAVE, { evt: evt, target: this, currentTarget: this });\n            this.targetShape = null;\n        }\n        else if (eventsEnabled) {\n            this._fire(MOUSELEAVE, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n            this._fire(MOUSEOUT, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n        this.pointerPos = undefined;\n        this._pointerPositions = [];\n        this._fire(CONTENT_MOUSEOUT, { evt: evt });\n    };\n    Stage.prototype._mousemove = function (evt) {\n        var _a;\n        if (Global_1.Konva.UA.ieMobile) {\n            return this._touchmove(evt);\n        }\n        this.setPointersPositions(evt);\n        var pointerId = Util_1.Util._getFirstPointerId(evt);\n        var shape;\n        var targetShape = ((_a = this.targetShape) === null || _a === void 0 ? void 0 : _a.getStage()) ? this.targetShape : null;\n        var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n        if (eventsEnabled) {\n            shape = this.getIntersection(this.getPointerPosition());\n            if (shape && shape.isListening()) {\n                var differentTarget = targetShape !== shape;\n                if (eventsEnabled && differentTarget) {\n                    if (targetShape) {\n                        targetShape._fireAndBubble(MOUSEOUT, { evt: evt, pointerId: pointerId }, shape);\n                        targetShape._fireAndBubble(MOUSELEAVE, { evt: evt, pointerId: pointerId }, shape);\n                    }\n                    shape._fireAndBubble(MOUSEOVER, { evt: evt, pointerId: pointerId }, targetShape);\n                    shape._fireAndBubble(MOUSEENTER, { evt: evt, pointerId: pointerId }, targetShape);\n                    shape._fireAndBubble(MOUSEMOVE, { evt: evt, pointerId: pointerId });\n                    this.targetShape = shape;\n                }\n                else {\n                    shape._fireAndBubble(MOUSEMOVE, { evt: evt, pointerId: pointerId });\n                }\n            }\n            else {\n                if (targetShape && eventsEnabled) {\n                    targetShape._fireAndBubble(MOUSEOUT, { evt: evt, pointerId: pointerId });\n                    targetShape._fireAndBubble(MOUSELEAVE, { evt: evt, pointerId: pointerId });\n                    this._fire(MOUSEOVER, {\n                        evt: evt,\n                        target: this,\n                        currentTarget: this,\n                        pointerId: pointerId,\n                    });\n                    this.targetShape = null;\n                }\n                this._fire(MOUSEMOVE, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: pointerId,\n                });\n            }\n            this._fire(CONTENT_MOUSEMOVE, { evt: evt });\n        }\n        if (evt.cancelable) {\n            evt.preventDefault();\n        }\n    };\n    Stage.prototype._mousedown = function (evt) {\n        if (Global_1.Konva.UA.ieMobile) {\n            return this._touchstart(evt);\n        }\n        this.setPointersPositions(evt);\n        var pointerId = Util_1.Util._getFirstPointerId(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        DragAndDrop_1.DD.justDragged = false;\n        Global_1.Konva.listenClickTap = true;\n        if (shape && shape.isListening()) {\n            this.clickStartShape = shape;\n            shape._fireAndBubble(MOUSEDOWN, { evt: evt, pointerId: pointerId });\n        }\n        else {\n            this._fire(MOUSEDOWN, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: pointerId,\n            });\n        }\n        this._fire(CONTENT_MOUSEDOWN, { evt: evt });\n    };\n    Stage.prototype._mouseup = function (evt) {\n        if (Global_1.Konva.UA.ieMobile) {\n            return this._touchend(evt);\n        }\n        this.setPointersPositions(evt);\n        var pointerId = Util_1.Util._getFirstPointerId(evt);\n        var shape = this.getIntersection(this.getPointerPosition()), clickStartShape = this.clickStartShape, clickEndShape = this.clickEndShape, fireDblClick = false;\n        if (Global_1.Konva.inDblClickWindow) {\n            fireDblClick = true;\n            clearTimeout(this.dblTimeout);\n        }\n        else if (!DragAndDrop_1.DD.justDragged) {\n            Global_1.Konva.inDblClickWindow = true;\n            clearTimeout(this.dblTimeout);\n        }\n        this.dblTimeout = setTimeout(function () {\n            Global_1.Konva.inDblClickWindow = false;\n        }, Global_1.Konva.dblClickWindow);\n        if (shape && shape.isListening()) {\n            this.clickEndShape = shape;\n            shape._fireAndBubble(MOUSEUP, { evt: evt, pointerId: pointerId });\n            if (Global_1.Konva.listenClickTap &&\n                clickStartShape &&\n                clickStartShape._id === shape._id) {\n                shape._fireAndBubble(CLICK, { evt: evt, pointerId: pointerId });\n                if (fireDblClick && clickEndShape && clickEndShape === shape) {\n                    shape._fireAndBubble(DBL_CLICK, { evt: evt, pointerId: pointerId });\n                }\n            }\n        }\n        else {\n            this.clickEndShape = null;\n            this._fire(MOUSEUP, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: pointerId,\n            });\n            if (Global_1.Konva.listenClickTap) {\n                this._fire(CLICK, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: pointerId,\n                });\n            }\n            if (fireDblClick) {\n                this._fire(DBL_CLICK, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: pointerId,\n                });\n            }\n        }\n        this._fire(CONTENT_MOUSEUP, { evt: evt });\n        if (Global_1.Konva.listenClickTap) {\n            this._fire(CONTENT_CLICK, { evt: evt });\n            if (fireDblClick) {\n                this._fire(CONTENT_DBL_CLICK, { evt: evt });\n            }\n        }\n        Global_1.Konva.listenClickTap = false;\n        if (evt.cancelable) {\n            evt.preventDefault();\n        }\n    };\n    Stage.prototype._contextmenu = function (evt) {\n        this.setPointersPositions(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        if (shape && shape.isListening()) {\n            shape._fireAndBubble(CONTEXTMENU, { evt: evt });\n        }\n        else {\n            this._fire(CONTEXTMENU, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n        this._fire(CONTENT_CONTEXTMENU, { evt: evt });\n    };\n    Stage.prototype._touchstart = function (evt) {\n        var _this = this;\n        this.setPointersPositions(evt);\n        var triggeredOnShape = false;\n        this._changedPointerPositions.forEach(function (pos) {\n            var shape = _this.getIntersection(pos);\n            Global_1.Konva.listenClickTap = true;\n            DragAndDrop_1.DD.justDragged = false;\n            var hasShape = shape && shape.isListening();\n            if (!hasShape) {\n                return;\n            }\n            if (Global_1.Konva.captureTouchEventsEnabled) {\n                shape.setPointerCapture(pos.id);\n            }\n            _this.tapStartShape = shape;\n            shape._fireAndBubble(TOUCHSTART, { evt: evt, pointerId: pos.id }, _this);\n            triggeredOnShape = true;\n            if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n                evt.preventDefault();\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(TOUCHSTART, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id,\n            });\n        }\n        this._fire(CONTENT_TOUCHSTART, { evt: evt });\n    };\n    Stage.prototype._touchmove = function (evt) {\n        var _this = this;\n        this.setPointersPositions(evt);\n        var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n        if (eventsEnabled) {\n            var triggeredOnShape = false;\n            var processedShapesIds = {};\n            this._changedPointerPositions.forEach(function (pos) {\n                var shape = PointerEvents.getCapturedShape(pos.id) || _this.getIntersection(pos);\n                var hasShape = shape && shape.isListening();\n                if (!hasShape) {\n                    return;\n                }\n                if (processedShapesIds[shape._id]) {\n                    return;\n                }\n                processedShapesIds[shape._id] = true;\n                shape._fireAndBubble(TOUCHMOVE, { evt: evt, pointerId: pos.id });\n                triggeredOnShape = true;\n                if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n                    evt.preventDefault();\n                }\n            });\n            if (!triggeredOnShape) {\n                this._fire(TOUCHMOVE, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: this._changedPointerPositions[0].id,\n                });\n            }\n            this._fire(CONTENT_TOUCHMOVE, { evt: evt });\n        }\n        if (DragAndDrop_1.DD.isDragging && DragAndDrop_1.DD.node.preventDefault() && evt.cancelable) {\n            evt.preventDefault();\n        }\n    };\n    Stage.prototype._touchend = function (evt) {\n        var _this = this;\n        this.setPointersPositions(evt);\n        var tapEndShape = this.tapEndShape, fireDblClick = false;\n        if (Global_1.Konva.inDblClickWindow) {\n            fireDblClick = true;\n            clearTimeout(this.dblTimeout);\n        }\n        else if (!DragAndDrop_1.DD.justDragged) {\n            Global_1.Konva.inDblClickWindow = true;\n            clearTimeout(this.dblTimeout);\n        }\n        this.dblTimeout = setTimeout(function () {\n            Global_1.Konva.inDblClickWindow = false;\n        }, Global_1.Konva.dblClickWindow);\n        var triggeredOnShape = false;\n        var processedShapesIds = {};\n        var tapTriggered = false;\n        var dblTapTriggered = false;\n        this._changedPointerPositions.forEach(function (pos) {\n            var shape = PointerEvents.getCapturedShape(pos.id) ||\n                _this.getIntersection(pos);\n            if (shape) {\n                shape.releaseCapture(pos.id);\n            }\n            var hasShape = shape && shape.isListening();\n            if (!hasShape) {\n                return;\n            }\n            if (processedShapesIds[shape._id]) {\n                return;\n            }\n            processedShapesIds[shape._id] = true;\n            _this.tapEndShape = shape;\n            shape._fireAndBubble(TOUCHEND, { evt: evt, pointerId: pos.id });\n            triggeredOnShape = true;\n            if (Global_1.Konva.listenClickTap && shape === _this.tapStartShape) {\n                tapTriggered = true;\n                shape._fireAndBubble(TAP, { evt: evt, pointerId: pos.id });\n                if (fireDblClick && tapEndShape && tapEndShape === shape) {\n                    dblTapTriggered = true;\n                    shape._fireAndBubble(DBL_TAP, { evt: evt, pointerId: pos.id });\n                }\n            }\n            if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n                evt.preventDefault();\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(TOUCHEND, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id,\n            });\n        }\n        if (Global_1.Konva.listenClickTap && !tapTriggered) {\n            this.tapEndShape = null;\n            this._fire(TAP, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id,\n            });\n        }\n        if (fireDblClick && !dblTapTriggered) {\n            this._fire(DBL_TAP, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id,\n            });\n        }\n        this._fire(CONTENT_TOUCHEND, { evt: evt });\n        if (Global_1.Konva.listenClickTap) {\n            this._fire(CONTENT_TAP, { evt: evt });\n            if (fireDblClick) {\n                this._fire(CONTENT_DBL_TAP, { evt: evt });\n            }\n        }\n        if (this.preventDefault() && evt.cancelable) {\n            evt.preventDefault();\n        }\n        Global_1.Konva.listenClickTap = false;\n    };\n    Stage.prototype._wheel = function (evt) {\n        this.setPointersPositions(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        if (shape && shape.isListening()) {\n            shape._fireAndBubble(WHEEL, { evt: evt });\n        }\n        else {\n            this._fire(WHEEL, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n        this._fire(CONTENT_WHEEL, { evt: evt });\n    };\n    Stage.prototype._pointerdown = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERDOWN, PointerEvents.createEvent(evt));\n        }\n    };\n    Stage.prototype._pointermove = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERMOVE, PointerEvents.createEvent(evt));\n        }\n    };\n    Stage.prototype._pointerup = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n        }\n        PointerEvents.releaseCapture(evt.pointerId);\n    };\n    Stage.prototype._pointercancel = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n        }\n        PointerEvents.releaseCapture(evt.pointerId);\n    };\n    Stage.prototype._lostpointercapture = function (evt) {\n        PointerEvents.releaseCapture(evt.pointerId);\n    };\n    Stage.prototype.setPointersPositions = function (evt) {\n        var _this = this;\n        var contentPosition = this._getContentPosition(), x = null, y = null;\n        evt = evt ? evt : window.event;\n        if (evt.touches !== undefined) {\n            this._pointerPositions = [];\n            this._changedPointerPositions = [];\n            Util_1.Collection.prototype.each.call(evt.touches, function (touch) {\n                _this._pointerPositions.push({\n                    id: touch.identifier,\n                    x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n                    y: (touch.clientY - contentPosition.top) / contentPosition.scaleY,\n                });\n            });\n            Util_1.Collection.prototype.each.call(evt.changedTouches || evt.touches, function (touch) {\n                _this._changedPointerPositions.push({\n                    id: touch.identifier,\n                    x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n                    y: (touch.clientY - contentPosition.top) / contentPosition.scaleY,\n                });\n            });\n        }\n        else {\n            x = (evt.clientX - contentPosition.left) / contentPosition.scaleX;\n            y = (evt.clientY - contentPosition.top) / contentPosition.scaleY;\n            this.pointerPos = {\n                x: x,\n                y: y,\n            };\n            this._pointerPositions = [{ x: x, y: y, id: Util_1.Util._getFirstPointerId(evt) }];\n            this._changedPointerPositions = [\n                { x: x, y: y, id: Util_1.Util._getFirstPointerId(evt) },\n            ];\n        }\n    };\n    Stage.prototype._setPointerPosition = function (evt) {\n        Util_1.Util.warn('Method _setPointerPosition is deprecated. Use \"stage.setPointersPositions(event)\" instead.');\n        this.setPointersPositions(evt);\n    };\n    Stage.prototype._getContentPosition = function () {\n        if (!this.content || !this.content.getBoundingClientRect) {\n            return {\n                top: 0,\n                left: 0,\n                scaleX: 1,\n                scaleY: 1,\n            };\n        }\n        var rect = this.content.getBoundingClientRect();\n        return {\n            top: rect.top,\n            left: rect.left,\n            scaleX: rect.width / this.content.clientWidth || 1,\n            scaleY: rect.height / this.content.clientHeight || 1,\n        };\n    };\n    Stage.prototype._buildDOM = function () {\n        this.bufferCanvas = new Canvas_1.SceneCanvas({\n            width: this.width(),\n            height: this.height(),\n        });\n        this.bufferHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1,\n            width: this.width(),\n            height: this.height(),\n        });\n        if (!Global_1.Konva.isBrowser) {\n            return;\n        }\n        var container = this.container();\n        if (!container) {\n            throw 'Stage has no container. A container is required.';\n        }\n        container.innerHTML = EMPTY_STRING;\n        this.content = document.createElement('div');\n        this.content.style.position = RELATIVE;\n        this.content.style.userSelect = 'none';\n        this.content.className = KONVA_CONTENT;\n        this.content.setAttribute('role', 'presentation');\n        container.appendChild(this.content);\n        this._resizeDOM();\n    };\n    Stage.prototype.cache = function () {\n        Util_1.Util.warn('Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.');\n        return this;\n    };\n    Stage.prototype.clearCache = function () {\n        return this;\n    };\n    Stage.prototype.batchDraw = function () {\n        this.children.each(function (layer) {\n            layer.batchDraw();\n        });\n        return this;\n    };\n    return Stage;\n}(Container_1.Container));\nexports.Stage = Stage;\nStage.prototype.nodeType = STAGE;\nGlobal_2._registerNode(Stage);\nFactory_1.Factory.addGetterSetter(Stage, 'container');\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}